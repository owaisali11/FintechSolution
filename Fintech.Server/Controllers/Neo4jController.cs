using Fintech.Application.Repositories;
using Fintech.Domain.Responses;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;
using System.Net.Http;
using System.Text;
using System.Text.Json;
using JsonSerializer = System.Text.Json.JsonSerializer;

namespace Fintech.Server.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class Neo4jController : ControllerBase
    {
        private readonly INeo4jRepository _neo4JRepository;
       // private readonly HttpClient _httpClient;


        public Neo4jController(INeo4jRepository neo4JRepository)
        {
            _neo4JRepository = neo4JRepository;
            //_httpClient = httpClientFactory.CreateClient();

        }

           /* [HttpPost]
            public async Task<ActionResult<string>> GenerateCypherQuery()
            {
            // Construct the payload as a JSON string
            var payload = " { text: \"input: {\\n  \\\"version\\\": \\\"1.4.0-beta.0\\\",\\n  \\\"graph\\\": {\\n    \\\"nodes\\\": [\\n      {\\n        \\\"id\\\": \\\"n0\\\",\\n        \\\"position\\\": {\\n          \\\"x\\\": -80,\\n          \\\"y\\\": -129\\n        },\\n        \\\"caption\\\": \\\"Province\\\"\\n      },\\n      {\\n        \\\"id\\\": \\\"n1\\\",\\n        \\\"position\\\": {\\n          \\\"x\\\": -303,\\n          \\\"y\\\": -69\\n        },\\n        \\\"caption\\\": \\\"District\\\"\\n      },\\n      {\\n        \\\"id\\\": \\\"n2\\\",\\n        \\\"position\\\": {\\n          \\\"x\\\": -341,\\n          \\\"y\\\": 197\\n        },\\n        \\\"caption\\\": \\\"Household\\\"\\n      }\\n    ],\\n    \\\"relationships\\\": [\\n      {\\n        \\\"id\\\": \\\"n0\\\",\\n        \\\"type\\\": \\\"IN_DISTRICT\\\",\\n        \\\"fromId\\\": \\\"n2\\\",\\n        \\\"toId\\\": \\\"n1\\\"\\n      },\\n      {\\n        \\\"id\\\": \\\"n1\\\",\\n        \\\"type\\\": \\\"HAS_HOMES\\\",\\n        \\\"fromId\\\": \\\"n1\\\",\\n        \\\"toId\\\": \\\"n2\\\"\\n      },\\n      {\\n        \\\"id\\\": \\\"n2\\\",\\n        \\\"type\\\": \\\"IN_PROVINCE\\\",\\n        \\\"fromId\\\": \\\"n1\\\",\\n        \\\"toId\\\": \\\"n0\\\"\\n      },\\n      {\\n        \\\"id\\\": \\\"n3\\\",\\n        \\\"type\\\": \\\"HAS_DISTRICTS\\\",\\n        \\\"fromId\\\": \\\"n0\\\",\\n        \\\"toId\\\": \\\"n1\\\"\\n      }\\n    ]\\n  },\\n  \\\"dataModel\\\": {\\n    \\\"version\\\": \\\"1.4.0-beta.0\\\",\\n    \\\"graphSchemaRepresentation\\\": {\\n      \\\"version\\\": \\\"1.0.0\\\",\\n      \\\"graphSchema\\\": {\\n        \\\"nodeLabels\\\": [\\n          {\\n            \\\"$id\\\": \\\"nl:n0\\\",\\n            \\\"token\\\": \\\"Province\\\",\\n            \\\"properties\\\": [\\n              {\\n                \\\"$id\\\": \\\"p:1\\\",\\n                \\\"token\\\": \\\"province\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:2\\\",\\n                \\\"token\\\": \\\"province_name\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"string\\\"\\n                },\\n                \\\"nullable\\\": true\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"nl:n1\\\",\\n            \\\"token\\\": \\\"District\\\",\\n            \\\"properties\\\": [\\n              {\\n                \\\"$id\\\": \\\"p:3\\\",\\n                \\\"token\\\": \\\"district\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:4\\\",\\n                \\\"token\\\": \\\"province\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:5\\\",\\n                \\\"token\\\": \\\"district_name\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"string\\\"\\n                },\\n                \\\"nullable\\\": true\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"nl:n2\\\",\\n            \\\"token\\\": \\\"Household\\\",\\n            \\\"properties\\\": [\\n              {\\n                \\\"$id\\\": \\\"p:6\\\",\\n                \\\"token\\\": \\\"district\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:7\\\",\\n                \\\"token\\\": \\\"hhcode\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:8\\\",\\n                \\\"token\\\": \\\"ind_hh\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:9\\\",\\n                \\\"token\\\": \\\"no_married\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:10\\\",\\n                \\\"token\\\": \\\"age_1_5\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:11\\\",\\n                \\\"token\\\": \\\"age_6_17\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:12\\\",\\n                \\\"token\\\": \\\"age_18_60\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:13\\\",\\n                \\\"token\\\": \\\"age_60\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:14\\\",\\n                \\\"token\\\": \\\"earners\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:15\\\",\\n                \\\"token\\\": \\\"max_edu\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:16\\\",\\n                \\\"token\\\": \\\"edu_male\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:17\\\",\\n                \\\"token\\\": \\\"edu_female\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:18\\\",\\n                \\\"token\\\": \\\"college\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n          \\n            \\n              {\\n                \\\"$id\\\": \\\"p:21\\\",\\n                \\\"token\\\": \\\"BrickWall\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:22\\\",\\n                \\\"token\\\": \\\"no_of_rooms\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"integer\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:23\\\",\\n                \\\"token\\\": \\\"RCCRoof\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:24\\\",\\n                \\\"token\\\": \\\"FlushToilet\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:25\\\",\\n                \\\"token\\\": \\\"OwnHouse\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:26\\\",\\n                \\\"token\\\": \\\"electricity\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:27\\\",\\n                \\\"token\\\": \\\"gas\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:28\\\",\\n                \\\"token\\\": \\\"TapWater\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:29\\\",\\n                \\\"token\\\": \\\"mbike\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:30\\\",\\n                \\\"token\\\": \\\"car\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:31\\\",\\n                \\\"token\\\": \\\"AC\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:32\\\",\\n                \\\"token\\\": \\\"fridge\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:33\\\",\\n                \\\"token\\\": \\\"washingM\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:34\\\",\\n                \\\"token\\\": \\\"sewingM\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:35\\\",\\n                \\\"token\\\": \\\"TV\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:36\\\",\\n                \\\"token\\\": \\\"cooler\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:37\\\",\\n                \\\"token\\\": \\\"tractor\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:38\\\",\\n                \\\"token\\\": \\\"internet\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:39\\\",\\n                \\\"token\\\": \\\"mobile\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              },\\n              {\\n                \\\"$id\\\": \\\"p:40\\\",\\n                \\\"token\\\": \\\"laptop\\\",\\n                \\\"type\\\": {\\n                  \\\"type\\\": \\\"boolean\\\"\\n                },\\n                \\\"nullable\\\": true\\n              }\\n            ]\\n          }\\n        ],\\n        \\\"relationshipTypes\\\": [\\n          {\\n            \\\"$id\\\": \\\"rt:n0\\\",\\n            \\\"token\\\": \\\"IN_DISTRICT\\\",\\n            \\\"properties\\\": []\\n          },\\n          {\\n            \\\"$id\\\": \\\"rt:n1\\\",\\n            \\\"token\\\": \\\"HAS_HOMES\\\",\\n            \\\"properties\\\": []\\n          },\\n          {\\n            \\\"$id\\\": \\\"rt:n2\\\",\\n            \\\"token\\\": \\\"IN_PROVINCE\\\",\\n            \\\"properties\\\": []\\n          },\\n          {\\n            \\\"$id\\\": \\\"rt:n3\\\",\\n            \\\"token\\\": \\\"HAS_DISTRICTS\\\",\\n            \\\"properties\\\": []\\n          }\\n        ],\\n        \\\"nodeObjectTypes\\\": [\\n          {\\n            \\\"$id\\\": \\\"n:n0\\\",\\n            \\\"labels\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#nl:n0\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"n:n1\\\",\\n            \\\"labels\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#nl:n1\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"n:n2\\\",\\n            \\\"labels\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#nl:n2\\\"\\n              }\\n            ]\\n          }\\n        ],\\n        \\\"relationshipObjectTypes\\\": [\\n          {\\n            \\\"$id\\\": \\\"r:n0\\\",\\n            \\\"type\\\": {\\n              \\\"$ref\\\": \\\"#rt:n0\\\"\\n            },\\n            \\\"from\\\": {\\n              \\\"$ref\\\": \\\"#n:n2\\\"\\n            },\\n            \\\"to\\\": {\\n              \\\"$ref\\\": \\\"#n:n1\\\"\\n            }\\n          },\\n          {\\n            \\\"$id\\\": \\\"r:n1\\\",\\n            \\\"type\\\": {\\n              \\\"$ref\\\": \\\"#rt:n1\\\"\\n            },\\n            \\\"from\\\": {\\n              \\\"$ref\\\": \\\"#n:n1\\\"\\n            },\\n            \\\"to\\\": {\\n              \\\"$ref\\\": \\\"#n:n2\\\"\\n            }\\n          },\\n          {\\n            \\\"$id\\\": \\\"r:n2\\\",\\n            \\\"type\\\": {\\n              \\\"$ref\\\": \\\"#rt:n2\\\"\\n            },\\n            \\\"from\\\": {\\n              \\\"$ref\\\": \\\"#n:n1\\\"\\n            },\\n            \\\"to\\\": {\\n              \\\"$ref\\\": \\\"#n:n0\\\"\\n            }\\n          },\\n          {\\n            \\\"$id\\\": \\\"r:n3\\\",\\n            \\\"type\\\": {\\n              \\\"$ref\\\": \\\"#rt:n3\\\"\\n            },\\n            \\\"from\\\": {\\n              \\\"$ref\\\": \\\"#n:n0\\\"\\n            },\\n            \\\"to\\\": {\\n              \\\"$ref\\\": \\\"#n:n1\\\"\\n            }\\n          }\\n        ],\\n        \\\"constraints\\\": [\\n          {\\n            \\\"$id\\\": \\\"c:1\\\",\\n            \\\"name\\\": \\\"province_Province_uniq\\\",\\n            \\\"constraintType\\\": \\\"uniqueness\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n0\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:1\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"c:2\\\",\\n            \\\"name\\\": \\\"district_District_uniq\\\",\\n            \\\"constraintType\\\": \\\"uniqueness\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n1\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:3\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"c:3\\\",\\n            \\\"name\\\": \\\"hhcode_Household_uniq\\\",\\n            \\\"constraintType\\\": \\\"uniqueness\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n2\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:7\\\"\\n              }\\n            ]\\n          }\\n        ],\\n        \\\"indexes\\\": [\\n          {\\n            \\\"$id\\\": \\\"i:1\\\",\\n            \\\"name\\\": \\\"province_Province_uniq\\\",\\n            \\\"indexType\\\": \\\"default\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n0\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:1\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"i:2\\\",\\n            \\\"name\\\": \\\"district_District_uniq\\\",\\n            \\\"indexType\\\": \\\"default\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n1\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:3\\\"\\n              }\\n            ]\\n          },\\n          {\\n            \\\"$id\\\": \\\"i:3\\\",\\n            \\\"name\\\": \\\"hhcode_Household_uniq\\\",\\n            \\\"indexType\\\": \\\"default\\\",\\n            \\\"entityType\\\": \\\"node\\\",\\n            \\\"nodeLabel\\\": {\\n              \\\"$ref\\\": \\\"#nl:n2\\\"\\n            },\\n            \\\"properties\\\": [\\n              {\\n                \\\"$ref\\\": \\\"#p:7\\\"\\n              }\\n            ]\\n          }\\n        ]\\n      }\\n    },\\n    \\\"graphSchemaExtensionsRepresentation\\\": {\\n      \\\"nodeKeyProperties\\\": [\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n0\\\"\\n          },\\n          \\\"keyProperty\\\": {\\n            \\\"$ref\\\": \\\"#p:1\\\"\\n          }\\n        },\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n1\\\"\\n          },\\n          \\\"keyProperty\\\": {\\n            \\\"$ref\\\": \\\"#p:3\\\"\\n          }\\n        },\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n2\\\"\\n          },\\n          \\\"keyProperty\\\": {\\n            \\\"$ref\\\": \\\"#p:7\\\"\\n          }\\n        }\\n      ]\\n    },\\n    \\\"graphMappingRepresentation\\\": {\\n      \\\"dataSourceSchema\\\": {\\n        \\\"type\\\": \\\"local/csv\\\",\\n        \\\"tableSchemas\\\": [\\n          {\\n            \\\"$id\\\": \\\"t:1\\\",\\n            \\\"name\\\": \\\"master_all_KG.csv\\\",\\n            \\\"expanded\\\": true,\\n            \\\"fields\\\": [\\n              {\\n                \\\"name\\\": \\\"district\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"101\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"hhcode\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"101100101\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"ind_hh\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"8\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"no_married\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"2\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"age_1_5\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"age_6_17\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"5\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"age_18_60\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"3\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"age_60\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"earners\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"6\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"max_edu\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"3\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"edu_male\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"edu_female\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"3\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"college\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"total_income_hh\\\",\\n                \\\"type\\\": \\\"string\\\",\\n                \\\"sample\\\": \\\"250000\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"asset_value\\\",\\n                \\\"type\\\": \\\"string\\\",\\n                \\\"sample\\\": \\\"196200\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"BrickWall\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"no_of_rooms\\\",\\n                \\\"type\\\": \\\"integer\\\",\\n                \\\"sample\\\": \\\"3\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"RCCRoof\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"FlushToilet\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"OwnHouse\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"electricity\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"gas\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"TapWater\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"psu\\\",\\n                \\\"type\\\": \\\"float\\\",\\n                \\\"sample\\\": \\\"1011001.01\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"province\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"mbike\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"car\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"AC\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n       \\n              {\\n                \\\"name\\\": \\\"tractor\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"internet\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"mobile\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"1\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"laptop\\\",\\n                \\\"type\\\": \\\"boolean\\\",\\n                \\\"sample\\\": \\\"0\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"district_name\\\",\\n                \\\"type\\\": \\\"string\\\",\\n                \\\"sample\\\": \\\"Abbottabad\\\",\\n                \\\"include\\\": true\\n              },\\n              {\\n                \\\"name\\\": \\\"province_name\\\",\\n                \\\"type\\\": \\\"string\\\",\\n                \\\"sample\\\": \\\"KHYBER PAKHTUNKHAWA\\\",\\n                \\\"include\\\": true\\n              }\\n            ]\\n          }\\n        ]\\n      },\\n      \\\"nodeMappings\\\": [\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n0\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [\\n            {\\n              \\\"fieldName\\\": \\\"province\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:1\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"province_name\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:2\\\"\\n              }\\n            }\\n          ]\\n        },\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n1\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [\\n            {\\n              \\\"fieldName\\\": \\\"district\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:3\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"province\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:4\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"district_name\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:5\\\"\\n              }\\n            }\\n          ]\\n        },\\n        {\\n          \\\"node\\\": {\\n            \\\"$ref\\\": \\\"#n:n2\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [\\n            {\\n              \\\"fieldName\\\": \\\"district\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:6\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"hhcode\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:7\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"ind_hh\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:8\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"no_married\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:9\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"age_1_5\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:10\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"age_6_17\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:11\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"age_18_60\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:12\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"age_60\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:13\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"earners\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:14\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"max_edu\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:15\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"edu_male\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:16\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"edu_female\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:17\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"college\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:18\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"total_income_hh\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:19\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"asset_value\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:20\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"BrickWall\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:21\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"no_of_rooms\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:22\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"RCCRoof\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:23\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"FlushToilet\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:24\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"OwnHouse\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:25\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"electricity\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:26\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"gas\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:27\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"TapWater\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:28\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"mbike\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:29\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"car\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:30\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"AC\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:31\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"fridge\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:32\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"washingM\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:33\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"sewingM\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:34\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"TV\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:35\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"cooler\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:36\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"tractor\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:37\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"internet\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:38\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"mobile\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:39\\\"\\n              }\\n            },\\n            {\\n              \\\"fieldName\\\": \\\"laptop\\\",\\n              \\\"property\\\": {\\n                \\\"$ref\\\": \\\"#p:40\\\"\\n              }\\n            }\\n          ]\\n        }\\n      ],\\n      \\\"relationshipMappings\\\": [\\n        {\\n          \\\"relationship\\\": {\\n            \\\"$ref\\\": \\\"#r:n0\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [],\\n          \\\"fromMapping\\\": {\\n            \\\"fieldName\\\": \\\"hhcode\\\"\\n          },\\n          \\\"toMapping\\\": {\\n            \\\"fieldName\\\": \\\"district\\\"\\n          }\\n        },\\n        {\\n          \\\"relationship\\\": {\\n            \\\"$ref\\\": \\\"#r:n1\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [],\\n          \\\"fromMapping\\\": {\\n            \\\"fieldName\\\": \\\"district\\\"\\n          },\\n          \\\"toMapping\\\": {\\n            \\\"fieldName\\\": \\\"hhcode\\\"\\n          }\\n        },\\n        {\\n          \\\"relationship\\\": {\\n            \\\"$ref\\\": \\\"#r:n2\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [],\\n          \\\"fromMapping\\\": {\\n            \\\"fieldName\\\": \\\"district\\\"\\n          },\\n          \\\"toMapping\\\": {\\n            \\\"fieldName\\\": \\\"province\\\"\\n          }\\n        },\\n        {\\n          \\\"relationship\\\": {\\n            \\\"$ref\\\": \\\"#r:n3\\\"\\n          },\\n          \\\"tableSchema\\\": {\\n            \\\"$ref\\\": \\\"#t:1\\\"\\n          },\\n          \\\"propertyMappings\\\": [],\\n          \\\"fromMapping\\\": {\\n            \\\"fieldName\\\": \\\"province\\\"\\n          },\\n          \\\"toMapping\\\": {\\n            \\\"fieldName\\\": \\\"district\\\"\\n          }\\n        }\\n      ]\\n    },\\n    \\\"configurations\\\": {\\n      \\\"idsToIgnore\\\": []\\n    }\\n  }\\n}\\n\\nTHIS is my knowledge graph \\nUse this neo4j schema for cypher query generation for the user question\\n\\nHow many districts in KPK\" },\r\n        { text: \"output: MATCH (:Province {province_name: 'KHYBER PAKHTUNKHAWA'})-[:HAS_DISTRICTS]->(d:District)\\nRETURN COUNT(d) AS numberOfDistrictsInKPK\" },\r\n        { text: \"input: avg number of cars per district in sindh?\" },\r\n        { text: \"output: cypher\\nMATCH (p:Province {province_name: 'SINDH'})-[:HAS_DISTRICTS]->(d:District)\\nMATCH (d)-[:HAS_HOMES]->(h:Household)\\nWHERE h.car = TRUE\\nRETURN d.district_name, avg(h.car) AS averageNumberOfCars\\n\" },\r\n        { text: `input: ${message}` },\r\n        { text: \"output: \" },";
                // Convert the payload to a StringContent object
                var content = new StringContent(payload, Encoding.UTF8, "application/json");

                // Send HTTP request to Google Generative AI API
                var response = await _httpClient.PostAsync("https://api.generative-ai.appspot.com/v1/models/gemini-1.5-pro-latest:generateContent?key=YOUR_API_KEY", content);

                // Check if request was successful
                if (response.IsSuccessStatusCode)
                {
                    // Extract the generated Cypher query from the response
                    var responseContent = await response.Content.ReadAsStringAsync();
                return responseContent;
                    // Handle response...
                }
                else
                {
                    // Handle unsuccessful request
                    return StatusCode((int)response.StatusCode, "Failed to generate Cypher query.");
                }
            }*/
    

    [HttpPost("CypherQuery")]
        public async Task<IActionResult> Get([FromBody] CypherQueryRequest request)
        {
            try
            {
                if (request == null)
                {
                return BadRequest("Invalid request body");
                }
                string cypherQuery = request.CypherQuery!;
                var result = await _neo4JRepository.RunQueryAsync(cypherQuery);
                return Ok(result);
            }
            catch (Exception ex)
            {
                return StatusCode(500, ex.Message);
            }
           
        }
    }
}
